---
title: "handout 2 - Xarxes Socials"
author: "Guillermo Gavilla Hernández"
date: "19/11/2020"
output: html_document
---


```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.align="center", echo=TRUE, warning=FALSE, message=FALSE,autodep = TRUE,cache=TRUE)
library(knitr)
library(printr)
library(igraph)
library(sna)
```

We shall consider again the undirected Facebook friendship network considered in the last handout. The links in this network are contained in the file **facebook_sample_anon.txt**. Download it on your computer and upload it to R as a dataframe. Define an undirected graph with this list of edges.



# Undirected Graph.

```{r read table }
data <- read.table("data/facebook_sample_anon.txt")
tail(data)
```
*Load data*

```{r generate a graph}
graph <- graph_from_data_frame(data, directed = F)
# plot(graph, edge.color = "darkgoldenrod1", edge.arrow.size = 0.001, edge.arrow.width = 1,
#     vertex.color = "cyan3", vertex.label= NA,
#     vertex.size = 12, rescale = T, main = "Undirected Graph from Facebook dataset")
graph

```


**1)**  It has been observed in many networks an association between "centrality" and "lethality," defined as the fatal disconnection of the network when nodes are removed. Let's study this association on this network.

#### Introducción "Conectividad"

```{r adjacency matrix }

#He creado una matriz de adjacencia para poder sacar el "connectedness score"

adj <- as_adjacency_matrix(graph, type = c("both", "upper", "lower"),
  attr = NULL, edges = FALSE, names = TRUE,
  sparse = F)

#print(paste(adj))

connectedness(adj)

# Observamos que el grado de connectividad es muy elevado ( =1 ). Por lo que podemos decir que     # tiene una conectividad perfecta.

```


```{r proba amb matriu de adjacencia}

# Hago una prueba para saber si esta bien,  quitando 2000 nodos a nuestro graph.

graph1 <- delete_vertices(graph, sample(4000,2000))

adj1 <- as_adjacency_matrix(graph1, type = c("both", "upper", "lower"),
  attr = NULL, edges = FALSE, names = TRUE,
  sparse = F)


(connectedness(adj1))

# La connectividad cae significativamente. ( =~ 0.5). Observamos que al quitar muchos nodos se
# reduce muchisimo las maneras de movernos en torno a los diferentes nodos de nuestro grafo.
# De esto podriamos deducir que podria haber una desconexion fatal al eliminar nodos.


```

```{r }

detach("package:sna", unload = T)



```




*a)* Repeat 1000 times the procedure of removing a random 0.1% of its set of nodes, and compute the average number of connected components of the resulting networks and the average fraction of the network represented by the largest component. Use set.seed to make your results reproducible.


```{r}

set.seed(270)

g1 <- NULL

for (i in 1:1000) {

  aux <- components(delete_vertices(graph, sample(4000,4)))$no; g1 <- c(g1, aux)

}

g1

mean(g1)

#components(graph)$no # Solo es para comparar resultados.

```

```{r}

sum(g1)

max(g1)/sum(g1)

# 0.0086 es la proporcion que tiene el grafo con el número más grande de conexiones sobre el total de conexiones.

```


*b)* Now, compute the number of connected components and the fraction represented by the largest component of the networks obtained after removing the most central 0.1% of nodes, for the following centrality indices (of course, if the most central 0.1% of nodes for two indices are the same set of nodes, you need not waste your time considering twice the same network): *degree*; *closeness*; *betweenness*; *page.rank*. (**Hint**: It might be convenient to define first a function that removes a given set of nodes of this graph and computes the number of connected components and the fraction represented by the largest component of the resulting network; then you will only need to apply it to the required different sets of most central nodes.) Is it what you expected?


```{r}




```




**2)** Now, consider the same graph as a directed one, and find the hubs and authorities scores. Compare with the page rank score.

```{r generate directed graph}

graph_directed <- graph_from_data_frame(data, directed = T)


```

```{r HUBS and AUTHORITIES}

hub_score <- hub_score(graph_directed, scale=T)$vector
authority_score <- authority_score(graph_directed, scale =T )$vector


par(mfrow=c(1,2))
set.seed(123)
plot(graph_directed,
     vertex.size=hub_score*30,
     main = "Hubs",
     vertex.color = rainbow(52),
     edge.arrow.size=0.1,
     layout = layout.kamada.kawai,
     vertex.label = NA)

plot(graph_directed,
     vertex.size=authority_score*30,
     main = "Authority",
     vertex.color = rainbow(52),
     edge.arrow.size=0.1,
     layout = layout.kamada.kawai,
     vertex.label = NA)


#Observamos en los gráficos como las zonas donde hay Hubs y Authority coinciden.


```

```{r Pagerank score}

page_rank <-page_rank(graph_directed)$vector

par(mfrow=c(1,2))
set.seed(123)

plot(graph_directed,
     vertex.size=page_rank*30,
     main = "Page rank",
     vertex.color = rainbow(52),
     edge.arrow.size=0.1,
     layout = layout.kamada.kawai,
     vertex.label = NA)

```

